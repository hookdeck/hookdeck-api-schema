# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml
  pagination: pagination.yml
  connection: connection.yml
  destination: destination.yml
  source: source.yml
  bulkretry: bulkretry.yml

types:
  AttemptId: string

  Attempt:
    properties:
      id:
        type: AttemptId
        docs: Attempt ID
      team_id:
        type: commons.TeamId
        docs: Team ID
      event_id:
        type: commons.EventId
        docs: Event ID
      response_status:
        type: integer
        docs: Attempts HTTP response code
      successful_at:
        type: datetime
        docs: Date the attempt was successful
      updated_at:
        type: datetime
        docs: Date the attempt was last updated
      created_at:
        type: datetime
        docs: Date the attempt was created
      error_code:
        type: string
        docs: Attempt could not complete because of an error
      bulk_retry_id:
        type: bulkretry.BulkRetryId
        docs: ID of associated bulk retry
      status:
        type: AttemptStatus
        docs: Attempt status
      trigger:
        type: AttemptTrigger
        docs: How this attempt was triggered
      attempt_number:
        type: integer
        docs: Sequential number of attempts (up to and including this one) made for the associated event
      delivered_at:
        type: datetime
        docs: Date the attempt was delivered
      responded_at:
        type: datetime
        docs: Date the destination responded to this attempt
      delivery_latency:
        type: integer
        docs: Time elapsed between attempt initiation and final delivery (in ms)
      archived_at:
        type: datetime
        docs: Time elapsed between attempt initiation and a response from the destination (in ms)
      body:
        type: string
        docs: Response body from the destination
      requested_url:
        type: string
        docs: URL of the destination where delivery was attempted

  AttemptStatus:
    enum:
      - PENDING
      - FAILED
      - SUCCESSFUL
      - QUEUED
      - HOLD

  AttemptTrigger:
    enum:
      - INITIAL
      - MANUAL
      - BULK_RETRY
      - UNPAUSE
      - AUTOMATIC

  AllAttempts:
    extends: pagination.Pagination
    properties:
      count: integer
      models: list<Attempt>

services:
  http:
    AttemptService:
      docs: |
        An attempt is any request that Hookdeck makes on behalf of an event.
      base-path: /attempts
      auth: true
      endpoints:
        retrieveAllAttempts:
          docs: This endpoint lists all attempts, or a subset of attempts.
          method: GET
          path: /
          query-parameters:
            event_id:
              type: optional<commons.EventId>
              docs: Event the attempt is associated with
          response: AllAttempts

        retrieveAttempt:
          docs: |
            This endpoint retrieves a specific attempt.
            When retrieving a completed attempt, the response will contain the body of the destination's response.
          method: GET
          path: /{id}
          path-parameters:
            id:
              type: AttemptId
              docs: Attempt ID
          response: Attempt
